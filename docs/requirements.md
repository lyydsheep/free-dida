# 简化版滴答清单 (Free-Dida) 需求文档

## 1. 任务管理模块 (Task Management)

### 1.1 核心实体定义 (Data Model)

为了保持轻量级，我们采用扁平化的任务结构。

```typescript
type TaskStatus = "todo" | "completed";
type TaskPriority = "p0" | "p1" | "p2" | "none"; // p0为最高优先级(红色)

interface Task {
  id: string; // UUID
  title: string; // 任务标题 (纯文本)
  description?: string; // 任务描述 (支持 Markdown)
  status: TaskStatus; // 状态
  priority: TaskPriority; // 优先级

  order: number; // 排序值 (用于手动拖拽排序，建议使用浮点数或 LexoRank 算法)

  // 时间相关
  dueDate?: number; // 截止时间 (时间戳，精确到毫秒)
  isAllDay?: boolean; // 是否为全天任务 (如果是，dueDate 通常设为当天的 23:59:59 或 00:00:00)

  // 子任务 (简化版：仅作为检查项，非独立任务)
  checklist?: {
    id: string;
    title: string;
    done: boolean;
  }[];

  // 元数据
  createdAt: number;
  updatedAt: number;
  completedAt?: number; // 完成时间
}
```

### 1.2 状态流转 (Workflow)

- **基本流转**：`Todo` <-> `Completed`
  - 用户点击复选框即可切换状态。
  - 完成的任务通常在列表中划掉并沉底，或移动到“已完成”列表。
- **删除**：
  - 硬删除，不支持软删除

### 1.3 属性细节

- **标题 (Title)**
  - 限制长度（例如 200 字符）。
  - **自然语言解析 (NLP)**：这是提升体验的关键。
    - 输入："明天下午3点开会" -> Title: "开会", DueDate: [明天 15:00]
    - 输入："买牛奶 !p0" -> Title: "买牛奶", Priority: P0

- **描述 (Description)**
  - 支持 Markdown 渲染（加粗、链接、代码块）。
  - MVP版本暂不支持直接上传图片/附件（可粘贴外部图片链接）。

- **优先级 (Priority)**
  - **P0 (High)**: 红色高亮，代表“紧急且重要”。
  - **P1 (Medium)**: 黄色/橙色，代表“重要不紧急”。
  - **P2 (Low)**: 蓝色，代表“紧急不重要”。
  - **None**: 灰色，默认值。

- **子任务 (Sub-tasks / Checklist)**
  - **逻辑**：子任务依附于父任务，不单独出现在全局列表或日历中。
  - **交互**：在任务详情页中添加/勾选。
  - **进度**：父任务列表页可展示子任务进度（例如 "2/5"）。
  - **自动完成**：所有子任务完成后，父任务**不**自动标记为完成（由用户决定）。

### 1.4 CRUD 交互设计

- **创建 (Create)**
  - **快速添加栏**：位于列表顶部或底部。
  - 支持 `Enter` 键提交。
  - 支持 `Tab` 键切换到描述或日期选择。

- **读取 (Read)**
  - 支持按 `DueDate` 排序。
  - 支持按 `Priority` 排序。
  - 支持按 `Title` 搜索。

- **更新 (Update)**
  - **行内编辑**：双击标题进行简单编辑。
  - **详情侧边栏/弹窗**：点击任务卡片打开详情页，进行全量属性编辑。
  - **拖拽**：
    - **列表内排序**：支持在同一分组（如同一优先级、同一天）内手动拖拽调整顺序，更新 `order` 字段。
    - **跨分组拖拽**：
      - 拖拽跨越优先级分组（如从 P1 拖到 P0），自动更新任务的 `priority` 并重新计算 `order`。
      - 拖拽到日历/看板的其他列，自动更新 `dueDate` 并重新计算 `order`。

- **删除 (Delete)**
  - 右键菜单 -> 删除。
  - 详情页 -> 删除按钮。

## 2. 交互与视图模块 (Interaction & Views)

### 2.1 日历看板视图 (Calendar Kanban View)

这是本项目的核心特色视图，结合了看板的直观与时间线的连续性。

- **核心概念**：一个可无限水平滑动的、基于日期的列式看板。
- **列 (Columns) 定义**：
  - **动态生成**：每一列代表一天。
  - **标题显示**：包含绝对日期和相对描述（例如："10月24日 周四 (今天)"）。
  - **预设模板**：
    - **紧凑视图**：显示 [昨天, 今天, 明天]。
    - **周视图**：显示 [昨天, ...未来6天]。
  - **自定义配置**：用户可配置显示的起始点（如从今天开始）和天数范围。
- **导航 (Navigation)**：
  - **无限滑动**：支持向左/右无限加载过去或未来的日期列。
  - **回到今天**：常驻悬浮按钮，一键滚动回“今天”列。
- **任务展示规则**：
  - **严格过滤**：仅展示设置了 `dueDate` 的任务。
  - **空状态**：若某天无任务，显示空白列并提供显眼的“+”按钮，点击即创建该日期的任务。
- **交互细节**：
  - **跨日拖拽**：将任务从一列拖到另一列，自动更新 `dueDate`。
    - 若原任务有具体时间（如 14:00），拖拽后保持时间不变，仅修改日期。
    - 若原任务为全天任务，拖拽后仍为全天任务。

### 2.2 清单视图 (List View)

最基础的视图，用于快速浏览和管理所有任务。

- **分组**：支持按“日期”、“优先级”分组。
- **快速添加**：顶部常驻输入框，支持自然语言解析。

### 2.3 四象限视图 (Eisenhower Matrix)

基于重要紧急程度的任务分类。

- **第一象限 (重要且紧急)**：P0 + (今天/已过期)
- **第二象限 (重要不紧急)**：P0/P1 + (未来/无日期)
- **第三象限 (紧急不重要)**：P2 + (今天/已过期)
- **第四象限 (不重要不紧急)**：P2/None + (未来/无日期)

## 3. 数据存储方案 (Data Storage)

采用 **Local-First (本地优先)** 架构，确保极致的响应速度和离线可用性。

### 3.1 技术选型 (PWA)

为了实现跨平台兼容性并保持轻量级，我们采用 **Progressive Web App (PWA)** 进行开发。

- **核心框架**: **React** (使用 Vite 构建)
- **语言**: **TypeScript**
- **样式**: **Tailwind CSS**
- **状态管理**: **Zustand**
  - _理由_: 极简的 API，Hooks 风格，性能开销极低。
- **持久化存储**: **IndexedDB** (配合 `idb-keyval` 或 `Dexie.js`)
  - _理由_: 浏览器原生的大容量存储，支持异步操作，适合 Local-First 架构。
  - _策略_:
    - 应用启动时，将所有任务数据从 IndexedDB 加载到 Zustand Store (内存)。
    - 所有的增删改查操作都在内存中进行（极致流畅）。
    - 使用监听器将变更异步写入 IndexedDB。
    - _注_: 对于个人任务管理应用，即使有 10,000 条任务，JSON 序列化后的体积也仅几 MB，现代浏览器内存完全可以轻松承载。

### 3.2 备选方案 (针对海量数据)

如果未来需要支持数万条以上的历史归档任务，或者需要复杂的 SQL 查询能力，可以平滑迁移到：

- **RxDB** (基于 IndexedDB/PouchDB)
  - _特点_: 响应式数据库，支持实时同步，离线优先。
  - _适用场景_: 数据量巨大，需要高级查询或多端实时同步时。

### 3.3 跨平台支持

- **Web**: 响应式设计，适配桌面端和移动端浏览器。
- **Mobile**: 通过 PWA 安装到主屏幕，提供类原生体验（离线访问、独立窗口）。
